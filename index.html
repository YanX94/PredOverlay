<!DOCTYPE html>
<html lang="fr">

<head>
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.4.2/css/all.css">


  <meta charset="UTF-8" />
  <title>PredOverlay</title>
  <style>
    @font-face {
      font-family: 'Storica';
      src: url('assets/althawra fikra Bold.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'WeissenhofGrotesk';
      src: url('assets/WeissenhofGrotesk-Medium.ttf') format('truetype');
      font-weight: 500;
      font-style: normal;
    }

    html,
    body {
      margin: 0;
      padding: 0;

      font-family: 'WeissenhofGrotesk', 'Storica', Arial, sans-serif;
      user-select: none;
      overflow: hidden;
    }

    #overlay-box {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 800px;
      background: rgba(24, 26, 27, 0.92);
      color: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.7);
      border: 1px solid #232323;
      overflow: hidden;
    }

    #title-bar {
      padding: 0px 12px;
      background: linear-gradient(90deg, #232323 60%, #23232300 100%);
      font-family: 'Storica', sans-serif;
      font-weight: bold;
      font-size: 18px;
      letter-spacing: 1px;
      color: #fff;
      border-bottom: 1px solid #232323;
      cursor: move;
      -webkit-app-region: drag;
    }

    #content {
      padding: 10px 10px 16px 18px;
      font-size: 17px;
      color: #e2e2e2;

    }

    #status {

      padding: 2px 8px;
      /* padding vertical égal */
      border-radius: 8px;
      font-size: 15px;
      font-weight: bold;

      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px #0004;
    }

    .active {
      background: linear-gradient(90deg, #2ecc40 60%, #2ecc4000 100%);
      color: #fff;
      border: 1px solid #2ecc40;

      padding-bottom: 5px !important;
      margin-bottom: 5px !important;
    }

    .inactive {
      background: linear-gradient(90deg, #e74c3c 60%, #e74c3c00 100%);
      color: #fff;
      border: 1px solid #e74c3c;
      padding-bottom: 5px !important;
      margin-bottom: 5px !important;
    }

    #item-slots {
      padding-top: 95px;
      display: flex;
      gap: 12px;
      /*margin-top: 160px;*/

    }

    .item-slot {
      width: 68px;
      height: 68px;
      background: linear-gradient(135deg, #232323 70%, #23232300 100%);
      border: 2px solid #393939;
      border-radius: 12px;
      box-shadow: 0 2px 12px #0006;
      cursor: pointer;
      transition: border-color 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .item-slot:hover {
      border-color: #2ecc40;
    }



    #item-modal::-webkit-scrollbar {
      display: none;
      /* Chrome, Safari, Opera */
    }

    .skill-order {
      background: rgba(24, 26, 27, 0.92);
      border-radius: 16px;
      padding: 12px;
      width: fit-content;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.7);
      border: 1px solid #232323;
      margin-top:8px;
    }

    table {
      border-collapse: collapse;
    }

    td {
      width: 38px;
      height: 38px;
      text-align: center;
      vertical-align: middle;
      border: 1px solid #232323;
      cursor: pointer;
      font-weight: bold;
      user-select: none;
      background: rgba(32, 34, 36, 0.7);
      color: #e2e2e2;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .skill-icon img {
      width: 34px;
      height: 34px;
      filter: drop-shadow(0 2px 6px #0008);
    }

    .skill-level {
      background: linear-gradient(90deg, #2ecc40 60%, #2ecc4000 100%);
      color: #fff;
    }


    #item-modal {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(24, 26, 27, 0.98);
      padding: 8px;
      max-height: 420px;
      overflow-y: auto;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.7);
      border: 1px solid #232323;
      z-index: 999;
    }

    #hero-modal {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(24, 26, 27, 0.98);
      padding: 8px;
      max-height: 420px;
      overflow-y: auto;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.7);
      border: 1px solid #232323;
      z-index: 999;
    }

    #hero-modal::-webkit-scrollbar {
      display: none;
      /* Chrome, Safari, Opera */
    }


    button,
    .hero-choice,
    .item-choice {
      transition: box-shadow 0.2s, border-color 0.2s;
    }

    button {
      background: linear-gradient(90deg, #232323 60%, #23232300 100%);
      color: #e2e2e2;
      border: 1px solid #393939;
      border-radius: 8px;
      font-size: 16px;
      /*padding: 8px 18px;*/
      font-family: inherit;
      cursor: pointer;
      margin-right: 8px;
      box-shadow: 0 2px 8px #0004;
    }

    button:hover {
      border-color: #2ecc40;
      color: #2ecc40;
    }

    .hero-choice,
    .item-choice {
      border-radius: 12px;
      border: 2px solid #393939;
      box-shadow: 0 2px 12px #0006;
      margin: 8px;
      width: 64px;
      height: 64px;
      background: #232323;
      cursor: pointer;
    }

    .hero-choice:hover,
    .item-choice:hover {
      border-color: #2ecc40 !important;
      box-shadow: 0 2px 16px #2ecc4066;
    }


    #close-hero-modal {
      border-radius: 50%;
      position: sticky;
      top: 0;
      left: 0;
      margin-left: 8px;
      margin-top: 8px;
      font-size: 28px;
      height: 40px;
      width: 40px;
      background: #232323;
      border: none;
      color: #ff3c3c;
      cursor: pointer;
      z-index: 1002;
      transition: color 0.2s, background 0.2s;
      box-shadow: 0 2px 12px #0008;
      float: right;
    }

    #close-hero-modal:hover {
      background: #ff3c3c;
      color: #fff;
    }



    #close-item-modal {
      border-radius: 50%;
      position: sticky;
      top: 0;
      left: 0;
      margin-left: 8px;
      margin-top: 8px;
      font-size: 28px;
      height: 40px;
      width: 40px;
      background: #232323;
      border: none;
      color: #ff3c3c;
      cursor: pointer;
      z-index: 1002;
      transition: color 0.2s, background 0.2s;
      box-shadow: 0 2px 12px #0008;
      float: right;
    }

    #close-item-modal:hover {
      background: #ff3c3c;
      color: #fff;
    }

    #choose-hero-btn:hover{
       border-color: #e4c42a !important;
      box-shadow: 0 2px 16px #927e1a;
      color: #e4c42a;
    }

    #save-config-btn:hover {
      border-color: #06e58d !important;
      box-shadow: 0 2px 16px #06e58d;
      color: #06e58d;
    }

    #clear-config-btn:hover {
      border-color: #ff3c3c !important;
      box-shadow: 0 2px 16px #ff3c3c;
      color: #ff3c3c;
    }

    .buttons-container {
  display: flex;
  flex-direction: row;

  float: right;
  margin-top: -6px;

}
  </style>
</head>

<body>




  <div id="overlay-box">





    <div id="title-bar">
      <img src="assets/ico_s.png" alt="Icon">
      PRED OVERLAY
      <span
        style="float:right; font-size:13px; color:#bbb; font-weight:normal; margin-top:12px; margin-right:8px; font-family: WeissenhofGrotesk;">v.07</span>



    </div>





    <div id="content">
     
     
      Interaction mode : <span id="status" class="inactive">LOCKED</span>



      Press <strong>F8</strong> to lock / unlock overlay.
    
      <div class="buttons-container" >
        <button id="clear-config-btn" style="width: 35px; height: 35px;">
    <i class="fa-solid fa-trash"></i>
      </button>

      <button id="save-config-btn" style="width: 35px; height: 35px;">
        <i class="fa-solid fa-floppy-disk"></i>
      </button>

      <button id="choose-hero-btn" style="width: 35px; height: 35px;">
        <i class="fa-solid fa-mask"></i>
      </button>
</div>
    
    



    

    </div>
  </div>

  <div id="item-slots">
    <div class="item-slot" data-index="0"></div>
    <div class="item-slot" data-index="1"></div>
    <div class="item-slot" data-index="2"></div>
    <div class="item-slot" data-index="3"></div>
    <div class="item-slot" data-index="4"></div>
    <div class="item-slot" data-index="5"></div>
    <div class="item-slot" data-index="6"></div>
  </div>

  <div id="item-modal" style="display:none;"></div>

  <div id="hero-selector">

    <span id="selected-hero" style="font-weight:bold;"></span>

  </div>
  <div id="hero-modal">
    <button id="close-hero-modal" style="">✖</button>
  </div>

  <div class="skill-order">
    <table id="skill-table">
      <!-- Rows will be generated dynamically -->
    </table>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    ipcRenderer.on('update-clickable-status', (_, isClickable) => {
      const status = document.getElementById('status');
      const overlayBox = document.getElementById('overlay-box');

      if (isClickable) {
        status.className = 'active';
        status.innerText = 'UNLOCKED';
        overlayBox.style.display = 'block';
      } else {
        status.className = 'inactive';
        status.innerText = 'LOCKED';
        overlayBox.style.display = 'none';
      }
    });
  </script>

  <script>
    const slots = document.querySelectorAll('.item-slot');
    const modal = document.getElementById('item-modal');
    let itemsCache = [];

    slots.forEach(slot => {

      slot.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        slot.innerHTML = '';
      });



      slot.addEventListener('click', async () => {
        const index = slot.dataset.index;

        if (itemsCache.length === 0) {
          try {
            const res = await fetch("assets/items.json");
            itemsCache = await res.json();
          } catch (err) {
            console.error("Erreur lors de la récupération des items :", err);
            return;
          }
        }
        // Button "✖" to close the items selector
        modal.innerHTML = `<button id="close-item-modal">✖</button>` +
          itemsCache.map(item =>
            `<img src="${item.image}" data-id="${item.id}" class="item-choice" title="${item.name}" style="width:64px;height:64px;margin:6px;cursor:pointer;border:2px solid #222;">`
          ).join('');
        modal.style.display = 'block';

        document.getElementById('close-item-modal').onclick = () => {
          modal.style.display = 'none';
        };

        document.querySelectorAll('.item-choice').forEach(img => {
          img.addEventListener('click', () => {
            const selected = itemsCache.find(i => i.id == img.dataset.id);
            slot.innerHTML = `<img src="${selected.image}" alt="${selected.name}" style="width: 64px; height: 64px;">`;
            modal.style.display = 'none';
          });
        });
      });
    });
  </script>

  <script>
    const skills = ['mouse-right', 'q', 'e', 'r'];
    const table = document.getElementById('skill-table');
    const maxLevels = 18;
    let currentLevel = 1;

    const state = Array(4).fill(null).map(() => Array(maxLevels).fill(null));

    function createTable() {
      for (let i = 0; i < skills.length; i++) {
        const row = document.createElement('tr');

        const iconCell = document.createElement('td');
        iconCell.classList.add('skill-icon');
        const img = document.createElement('img');
        img.src = `assets/${skills[i]}.png`;
        img.alt = skills[i].toUpperCase();
        iconCell.appendChild(img);
        row.appendChild(iconCell);

        for (let j = 0; j < maxLevels; j++) {
          const cell = document.createElement('td');
          cell.dataset.row = i;
          cell.dataset.col = j;
          cell.addEventListener('click', handleLeftClick);
          cell.addEventListener('contextmenu', handleRightClick);
          row.appendChild(cell);
        }

        table.appendChild(row);
      }
    }

    function handleLeftClick(e) {
      const row = parseInt(e.target.dataset.row);
      const col = parseInt(e.target.dataset.col);

      if (state[row][col] === null && currentLevel <= maxLevels) {
        state[row][col] = currentLevel;
        e.target.classList.add('skill-level');
        e.target.textContent = currentLevel++;
      }
    }

    function handleRightClick(e) {
      e.preventDefault();
      const row = parseInt(e.target.dataset.row);
      const col = parseInt(e.target.dataset.col);

      if (state[row][col] !== null) {
        const removed = state[row][col];
        state[row][col] = null;
        e.target.classList.remove('skill-level');
        e.target.textContent = '';

        for (let i = 0; i < state.length; i++) {
          for (let j = 0; j < state[i].length; j++) {
            if (state[i][j] && state[i][j] > removed) {
              state[i][j] -= 1;
              const cell = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
              cell.textContent = state[i][j];
            }
          }
        }

        currentLevel -= 1;
      }
    }

    createTable();
  </script>

  <script>
    let heroesCache = [];
    let selectedHero = null;

    const heroBtn = document.getElementById('choose-hero-btn');
    const heroModal = document.getElementById('hero-modal');
    const selectedHeroSpan = document.getElementById('selected-hero');

    // Charge la liste locale des héros
    async function loadHeroes() {
      if (heroesCache.length === 0) {
        try {
          const res = await fetch("assets/heroes.json");
          heroesCache = await res.json();
        } catch (err) {
          console.error("Erreur lors du chargement des héros :", err);
          heroesCache = []; // fallback vide
        }
      }
    }

    // Ouvre le modal de sélection de héros
    heroBtn.addEventListener('click', async () => {
      await loadHeroes();

      heroModal.innerHTML = `<button id="close-hero-modal" style="">✖</button>` +
        heroesCache.map(hero =>
          `<img src="${hero.image}" data-id="${hero.id}" title="${hero.display_name || hero.name}" class="hero-choice" style="width:64px;height:64px;margin:6px;cursor:pointer;border:2px solid #222;">`
        ).join('');
      heroModal.style.display = 'block';

      document.getElementById('close-hero-modal').onclick = () => {
        heroModal.style.display = 'none';
      };

      document.querySelectorAll('.hero-choice').forEach(img => {
        img.addEventListener('click', () => {
          selectedHero = heroesCache.find(h => h.id == img.dataset.id);
          selectedHeroSpan.textContent = selectedHero.display_name || selectedHero.name;
          selectedHeroSpan.style.color = "#0ff";
          heroModal.style.display = 'none';
          loadHeroConfig(selectedHero.id); // Charge la config du héros sélectionné
        });
      });
    });

    // Fermer le modal si on clique en dehors
    document.addEventListener('click', (e) => {
      if (heroModal.style.display === 'block' && !heroModal.contains(e.target) && e.target !== heroBtn) {
        heroModal.style.display = 'none';
      }
    });
  </script>

  <script>
    // Sauvegarde la config du héros sélectionné
    function saveHeroConfig() {
      if (!selectedHero) return;
      const config = {
        items: Array.from(document.querySelectorAll('.item-slot')).map(slot => slot.querySelector('img')?.src || null),
        skillOrder: state.map(row => [...row]), // copie profonde
      };
      localStorage.setItem('heroConfig_' + selectedHero.id, JSON.stringify(config));
    }

    // Charge la config du héros sélectionné
    function loadHeroConfig(heroId) {
      const configStr = localStorage.getItem('heroConfig_' + heroId);
      if (!configStr) {
        // Réinitialise les items
        document.querySelectorAll('.item-slot').forEach(slot => {
          slot.innerHTML = '';
        });
        // Réinitialise le skill order
    // Réinitialise le skill order
    for (let i = 0; i < state.length; i++) {
      for (let j = 0; j < state[i].length; j++) {
        state[i][j] = null;
        const cell = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
        if (cell) {
          cell.classList.remove('skill-level');
          cell.textContent = '';
        }
      }
    }
    currentLevel = 1; // <-- Place ici, après la boucle
    return;
  }
      const config = JSON.parse(configStr);

      // Items
      document.querySelectorAll('.item-slot').forEach((slot, i) => {
        slot.innerHTML = config.items[i] ? `<img src="${config.items[i]}" style="width:64px;height:64px;">` : '';
      });

      // Skill order
      for (let i = 0; i < state.length; i++) {
        for (let j = 0; j < state[i].length; j++) {
          state[i][j] = config.skillOrder[i][j];
          const cell = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
          if (cell) {
            if (state[i][j]) {
              cell.classList.add('skill-level');
              cell.textContent = state[i][j];
            } else {
              cell.classList.remove('skill-level');
              cell.textContent = '';
            }
          }
        }
      }
      currentLevel = Math.max(1, ...state.flat().filter(x => x !== null));
    }

    // Branche le bouton Save
    document.getElementById('save-config-btn').addEventListener('click', saveHeroConfig);
  </script>
</body>

</html>